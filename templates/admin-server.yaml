# apiVersion: apps/v1
# kind: Deployment
# metadata:
#   name: {{ .Release.Name }}-admin-server
#   namespace: {{ .Values.namespace }}
#   labels:
#     app: admin-server
# spec:
#   replicas: {{ .Values.admin_server.replicaCount }}
#   selector:
#     matchLabels:
#       app: admin-server
#   template:
#     metadata:
#       labels:
#         app: admin-server
#     spec:
#       containers:
#         - name: admin-server
#           image: "{{ .Values.admin_server.image }}"
#           ports:
#             - containerPort: {{ .Values.admin_server.port }}
#           resources:
#             limits:
#               memory: {{ .Values.admin_server.resources.limits.memory | quote }}
#           env:
#             - name: SPRING_PROFILES_ACTIVE
#               value: {{ .Values.admin_server.env.SPRING_PROFILES_ACTIVE | quote }}
#             - name: SPRING_CLOUD_CONFIG_URI
#               value: {{ .Values.admin_server.env.SPRING_CLOUD_CONFIG_URI | replace "config-server" (printf "%s-config-server-svc" .Release.Name) | quote }}
#             - name: EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE
#               value: {{ .Values.admin_server.env.EUREKA_CLIENT_SERVICE_URL_DEFAULTZONE | replace "discovery-server" (printf "%s-discovery-server-svc" .Release.Name) | quote }}
#             - name: EUREKA_INSTANCE_HOSTNAME
#               valueFrom:
#                 fieldRef:
#                   fieldPath: status.podIP
#             - name: MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE
#               value: {{ .Values.admin_server.env.MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE | quote }}
#             - name: SPRING_CLOUD_DISCOVERY_HEALTH_TIMEOUT
#               value: {{ .Values.admin_server.env.SPRING_CLOUD_DISCOVERY_HEALTH_TIMEOUT | quote }}
#             - name: SPRING_CLOUD_DISCOVERY_CLIENT_HEALTHINDICATOR_USE-DISCOVERY-METADATA
#               value: {{ .Values.admin_server.env.SPRING_CLOUD_DISCOVERY_CLIENT_HEALTHINDICATOR_USE_DISCOVERY_METADATA | quote }}
#             - name: SPRING_CLOUD_DISCOVERY_CLIENT_HEALTHINDICATOR_MANAGEMENT_PORT
#               value: {{ .Values.admin_server.env.SPRING_CLOUD_DISCOVERY_CLIENT_HEALTHINDICATOR_MANAGEMENT_PORT | quote }}
#             - name: SPRING_CLOUD_DISCOVERY_HEALTH_RETRY_MAX_ATTEMPTS
#               value: {{ .Values.admin_server.env.SPRING_CLOUD_DISCOVERY_HEALTH_RETRY_MAX_ATTEMPTS | quote }}
#             - name: SPRING_CLOUD_DISCOVERY_HEALTH_RETRY_INITIAL_INTERVAL
#               value: {{ .Values.admin_server.env.SPRING_CLOUD_DISCOVERY_HEALTH_RETRY_INITIAL_INTERVAL | quote }}
#             - name: SPRING_CLOUD_DISCOVERY_CLIENT_HEALTHINDICATOR_MANAGEMENT_BASE_URL
#               value: {{ .Values.admin_server.env.SPRING_CLOUD_DISCOVERY_CLIENT_HEALTHINDICATOR_MANAGEMENT_BASE_URL | quote }}
#           readinessProbe:
#             httpGet:
#               path: /actuator/health
#               port: {{ .Values.admin_server.port }}
#             initialDelaySeconds: 5
#             periodSeconds: 5
# ---
# apiVersion: v1
# kind: Service
# metadata:
#   name: {{ .Release.Name }}-admin-server-svc
#   namespace: {{ .Values.namespace }}
#   labels:
#     app: admin-server
# spec:
#   selector:
#     app: admin-server
#   ports:
#     - protocol: TCP
#       port: {{ .Values.admin_server.port }}
#       targetPort: {{ .Values.admin_server.port }}
#     {{- if .Values.admin_server.nodePort }}
#     nodePort: {{ .Values.admin_server.nodePort }}
#     {{- end }}
#   type: {{ .Values.admin_server.serviceType | default "LoadBalancer" }}